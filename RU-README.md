# DiscordCardBot
Простенький бот, позволяющий коллекционировать карты участниками сервера.
[Настройка проекта](#Настройка-проекта) [en-README](./README.md)
## Описание
Участник дискорд сервера может при использовании команд этого бота:
 - [дайкарту](#дайкарту) : получить коллекционную карту 1 раз в 24 часа или просмотреть через сколько времени он ее сможет получить
 - [покажимне](#покажимне) :просмотреть список и количество карт одного типа, которые он уже получил
 - [профиль](#профиль) : просмотреть статистику пользователя сервера по выпавшим картам 
 - [помощь](#помощь) : получить справку о командах бота
 - [неисследовано](#неисследовано) : узнать количество карт, которых не выпало ни одному из участников сервера на данный момент 
 - [выдайкарту](#выдайкарту) : выдать 1 карту указанному пользователю
 - [активируй](#активируй-Code) : активировать код для получения шанса получить катру еще раз
 - [создатькод](#создатькод) : создать код, который могут использовать пользователи для получения возможности получить карту
 - [удалитькарту](#удалитькарту-CardName) : удалить карту из системы и у всех пользователей
 - [новаякарта](#новаякарта) : добавить в пул выпадения карт новую карту
 - [изменитькарту](#изменитькарту) : изменить существующую карту в системе и у всех пользователей
 - [обновикрутки](#обновикрутки) : дать возможность всем или конкретному пользователю получить карту
### дайкарту
Выдает рандомную карту из пула существующих в системе карточек 1 раз в 24 часа или же 1 раз в день в определенное время в зависимости от настройки бота.
У этой команды присутствует механика, при которой если пользователь получает 3ю повторяющуюся карту, то система дает шанс использовать эту команду еще раз.
![](https://media.discordapp.net/attachments/852679774128439386/1008089528965267487/unknown.png)
### покажимне [@UserMention]
При вводе команды **без аргументов** показывает инвентарь пользователя - **автора сообщения**.

При добавлении в качестве аргумента **упоминания пользователя(через @)** покажет инвентарь указанного пользователя (при условии что админ включил данную возможность в конфиге: **INVENTORY_PUBLIC_ACCESS = 1** )

![](https://cdn.discordapp.com/attachments/852679774128439386/1008397459397017600/unknown.png)

Инвентарь имеет страничный интерфейс, где страницы меняются путем добавлений реакций стрелочек(⬅️ и ➡️) которые предлагает бот, страницы меняются только в том случае если реацкцию под сообщением с инвентарем оставил автор отправленной команды.
Спустя некоторое время (которое настраивается в конфиге: **INVENTORY_TIME**) при бездействии инвентаря - отсутсвтие активного переключения страниц, инвентарь перестает работать, и для того чтобы еще раз его посмотреть нужно снова ввести нужную команду.  
 
### профиль [@UserMention]
 Показывает профиль указанного пользователя или автора сообщения со статистикой собранных карт за все время.

![](https://media.discordapp.net/attachments/852679774128439386/1008119707318091816/unknown.png) 
 
### помощь
Выводит перечень всех команд, доступных автору сообщения.
Если помощь запросил администратор сервера, то бот выведет расширенный список команд.

![](https://cdn.discordapp.com/attachments/852679774128439386/1008404455957483602/unknown.png)

### неисследовано 
Выводит количество карт, которых нет ни у одного из зарегистрированных участников.

![](https://cdn.discordapp.com/attachments/852679774128439386/1008407426413891654/unknown.png)

### выдайкарту @UserMention CardName
Выдает указанному пользователю карту, найденную по вписанному имени(или части имени).

Команду может использовать **только администратор сервера**. Для использования этой функции нужны 2 обязательных аргумента:
 - @UserMention: пользователь которому будет выдаваться карта
 - CardName: название карты, которая будет выдана в количестве 1 штуки пользователю. Этот аргумент может принимать неполное название карты, система найдет наиболее подоходящую по введеному имени карты

![](https://cdn.discordapp.com/attachments/852679774128439386/1008408519663431681/unknown.png)

### активируй Code
Активация кода, созданного администратором, при успешной активации пользователем обнуляет ему кулдаун для использования команды **дайкарту**

![](https://cdn.discordapp.com/attachments/852679774128439386/1008413555302879302/unknown.png)

### создатькод [-c] [-u] [-d]
Создает специальный код который могут активировать пользователи для получения возможности сбросить кулдаун команды **дайкарту**
Этой командой может воспользоваться только администратор при этом ему доступны для использования 3 необязательных параметра которые можно использовать в любом порядке для установки ограничений на использование кода:
 - -cCodeName : кастомное название кода
 - -uUsingCount : количество уникальных пользователей, которые могу использовать код
 - -dmm/dd/yyyy : дата истечения срока годности кода, после которой пользователи не смогут его использовать

![](https://media.discordapp.net/attachments/852679774128439386/1008413384590503957/unknown.png)

По умолчанию создается автоматически сгенерированный код без срока годности на 1 использование.

![](https://media.discordapp.net/attachments/852679774128439386/1008418844068544582/unknown.png)

### удалитькарту CardName
Админская команда, удаляющая из системы и у всех пользователей указанную карту.

Данная команда требует 1 обязательный аргумент - **полное название карты.**

![](https://cdn.discordapp.com/attachments/852679774128439386/1008423799160582265/unknown.png)

**Если в названии карты есть пробел, то вместо него используйте ";" тк пробел служит для разделения аргументов.**

### новаякарта CardName ClassNumber [ImageSourceLink]
Админ сервера может создать новую карту, которая автоматически помещается в пул выпадения карт.
Аргументы команды:
 - CardNameCardName **название новой карты**, (обязательный) - не должно совпадать с существующим именем карты в базе, для добавления пробела используйте символ ";" 
 - ClassNumber **класс карты**, (обязательный) должно быть числом от  1 до 5 - стандартные классы карт, другие значения сделают картой нестандартного класса
 - ImageSourceLink **ссылка на картинку .png .jpg .gif**, обязательный аргумент, который можно не вводить при условии, что к сообщению этой команды во вложение прикреплена картинка.

![](https://media.discordapp.net/attachments/852679774128439386/1008427304545955962/unknown.png)
 
 ### изменитькарту CardName editCardName editClassNumber [editImageSourceLink]
 Команда доступная только администратору, созданная для изменения данных существующих карт, требует следующие аргументы:
 - CardName (обязательный) - полное название карты которую требуется изменить
 - editCardName (обязательный) - новое название карты, если не хотите менять вставьте то которое есть (напоминание использовать ";" вместо пробела)
 - editClassNumber - новый класс карты, должно быть числом
 - editImageSourceLink - новое изображение (ссылка на изображение) для отображения

![](https://media.discordapp.net/attachments/852679774128439386/1008434737418870914/unknown.png)

 ### обновикрутки [@UserMention]
Сбрасывает кулдаун команды **дайкарту** для всех пользователей или только указанному. (Доступно только администратору)

![](https://cdn.discordapp.com/attachments/852679774128439386/1008436051947303073/unknown.png)

## Новости
 **Крупное обновление от 11.08.2022**
 - Добавлено администрирование карт при помощи команд(добавление, изменение и удаление)
 - Добавлена возможность выбора языка и добавления своей локализации, сейчас бот поддерживает русский и английский языки.
 - Добавлена возможность создания/активации специальных кодов которые могут использовать пользователи для получения круток
 - Добавлена функция обнуления кулдауна выдачи карт всем пользователям или какому-нибудь конкретному
 - Исправлены ошибки с регистрацией пользователей и влекших за собой остановку работы бота, добавлены новые)
 - Добавлено отображение количества нестандартных карт в профиле пользователя
 - При получении карты теперь указывается сколько таких же пользователь имеет в инвентаре


 **фича от 09.12.2021**
 - теперь можно установить серверное время в момент которого, таймер всех пользователей для получения карты(**дайкарту**) обнуляется.
 
 **обновление от 30.11.2021**
 - В названии карт встроены ссылки, что позволяет использовать url любой длинны без порчи вида сообщения.
 - Исправлен баг, при котором не отображалась ценность(**class**) карт символами/эмодзи в **покажимне**.
 - Убрано отображение url в **профиль** (теперь ссылка в названии карты).
 - Изменен внешний вид для **дайкарту**.

![](https://media.discordapp.net/attachments/852679774128439386/915276541347381268/drop.png)

 - Изменен внешний вид для **покажимне**.

![](https://media.discordapp.net/attachments/852679774128439386/915276541573881896/покажимне.png)

 - Добавлена возможность просматривать чужой инвентарь(**покажимне @UserMention**), при условии если данная функция разрешена(параметром в конфиге **INVENTORY_PUBLIC_ACCESS = 1**).

 **небольшое обновление от 21.11.2021**
  - Добавлены тестовые карты в **db.json** для примера их добавления. 

![](https://cdn.discordapp.com/attachments/852679774128439386/911969469914574939/unknown.png)

  - Добавлено отображение количества карт каждого класса при просмотре профиля(**профиль**).

![](https://cdn.discordapp.com/attachments/852679774128439386/911967665906651166/unknown.png)

 **фича от 06.10.2021**
  - Добавлена команда **undiscovered**. Выводит количество карт, которых на сервере еще никому не удавалось получить.

![](https://cdn.discordapp.com/attachments/852679774128439386/895117207615471666/unknown.png)

 **фича от 26.09.2021**
  - Добавлена команда **профиль** [@UserMention]. Выводит профиль пользователя, содержащий информацию:
      - сколько карт всего выпало;
      - какое количество карт выпало определенного класса;
      - количество карт, которых пользователь еще не открыл;
      - карта, котороая больше всего раз выпала.
  - Добавлены поля для карт: **class**(класс карты), предназначенные для определения ценности/редкости карты.

 **небольшое обновление от 04.08.2021**
 - При просмотре инвентаря теперь показывается не только текущая страница, но и сколько всего страниц доступно.
 - При истечении срока работы инвентаря все реакции, прикрепленные к сообщению удаляются.

 **фича от 31.07.2021**
 - Чтобы не превышать максимальное количество символов в сообщении для API Discord`а был введен "страничный" инвентарь:
после ввода команды о запросе показать инвентарь, бот показывает вам последнюю страницу инвентаря, в которой содержатся ваши недавно полученные коллекционные карты. Вы можете перелистывать страницы инвентаря при помощи реакций(⬅️ и ➡️) в сообщении с вашими картами. Учтите, бот не будет бесконечно ждать, когда вы соизволете пролистнуть страницу, через некоторое время он перестанет реагировать на новые реакции, и вам придется запросить инвентарь командой снова.

 **фича от 11.06.2021**
- При получении одной и той же карты каждый 3й раз, участнику сервера дается возможность сразу же попытаться выбить еще одну карту.
- Теперь, когда человек будет использовать команду для получения карты, но 24 часа с момента прошлого получения еще не прошли, бот покажет через сколько времни выдача карты будет доступна.

## Настройка проекта
1. **Склонируйте проект.**

2. **Убедитесь, что у вас установлено:**
 - ![Node.js](https://nodejs.org/en/) 10.0.0 или выше.

3. **Создайте конфигигурационный файл и занесите в него необходимую информацию.**

### Создание конфига
В корне проекта создайте конфигурационный файл **.env**
Пример файла .env :
```
TOKEN = "токен вашего бота"
PREFIX = '!' 
PAGE_SIZE = 7
INVENTORY_TIME = 60000
INVENTORY_PUBLIC_ACCESS = 1
RARE_CLASS_NUMBER = 5
CLASS_SYMBOL_FILL = ":star:"
CLASS_SYMBOL_OF_VOID = ":small_orange_diamond:"
RESET_LOCAL_TIME = ""
LOCALES = "en"
```

**PAGE_SIZE** - количество элементов, которые будут умещаться на одной странице инвентаря при показе

**INVENTORY_TIME** - время бездействия инвентаря, после которого бот перестает листать страницы, указывается в миллисекундах

**INVENTORY_PUBLIC_ACCESS** - доступ вызова инвентаря другого пользователя **1 - можете использовать покажимне @UserMention, 0 - другие пользователи могут только сами демонстрировать свой инвентарь в чате**

**RESET_LOCAL_TIME** - локальное время сервера во время которого происходит сброс таймера для **дайкарту** у всех пользователей одновременно. Формат значения поля: **"чч:мм:сс"**, например **RESET_LOCAL_TIME** = "16:45:00".  Если **""** - то при использовании **дайкарту** бот будет устанавливать время сброса каждому пользователю индивидуально.

**RARE_CLASS_NUMBER** - количество классов редкости/ценности

**CLASS_SYMBOL_FILL** - Discord emoji для заполнения шкалы редкости/ценности

**CLASS_SYMBOL_OF_VOID** - Discord emoji для заполнения пустоты шкалы редкости/ценности

**LOCALES** - настройка локализации бота en - английский, ru - русский язык

Иллюстрация ниже чтобы понять суть 3х последних параметров:
<br />
![](https://media.discordapp.net/attachments/852679774128439386/891748889118511134/env_decr.png)

4. **Добавьте необходимый контент для вашего сервера.**

### Подготовка контента
Откройте файл /storage/db.json
```
{
	"users": [], // Ссодержит данные участников сервера и их инвентарь 
	"cards": [], // Содержит данные о картах, которые могут выпасть на сервере
	"codes": [], // Содержит информацию о ивентовых кодах для пользователей
}
```

Данные о пользователях сервера **будут автоматически добавляться** по мере использования команд бота.
Данные о картах вам **придется заполнить самостоятельно**. 
Пример добавления карты в **db.json**
```
cards: [
    {
        "name": "test_card", // Название карты
        "class": 1, // ценность карты, определяется от 1 до RARE_CLASS_NUMBER включительно
        "active": true, // Флаг, определяющий, может ли катра вывпасть участникам сервера
        "url": "url_string.png"  // Ссылка на изображение карты
    }, 
]
```

Если вы только склонировали проект, то вы можете обнаружить что в **db.json** уже есть информация о тестовых картах с редкостью от 1 до 6 где карты с **class от 1 до 5 - стандартные** и та, что с **class 6 - нестандартная**(Что значит ее ценность не будет отображаться при помощи **CLASS_SYMBOL_FILL** и **CLASS_SYMBOL_OF_VOID**, учтите это, если же вы хотите как то отметить ее ценность символами/эмодзи, можете прописать их в поле названия карты, как в **db.json** репозитория).  

5. **Скачайте необходимые модули для работы проекта.**

### Подгрузка зависимостей
Откройте терминал в корне проекта, далее пропишите следующие команды:
```
npm i 
```
6. **После всех успешно проделанных шагов, вы можете запустить бота, прописав команду в терминале.**
### Запуск проекта
```
npm start 
```